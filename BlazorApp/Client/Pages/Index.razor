@page "/"
@using Core.Utilities
@using Core.Models.Ships
@using Core.Models

@using BlazorApp.Client.Components
@using Client.Services

@inject IEventService EventService
@inject IMessageService MessageService
@implements IDisposable

<CascadingValue Value="@GameMode">
    @* <hr>
    <h1>Opponent board</h1> *@

    @* <OpponentBoard /> *@

    <hr>
    <span>@GameMode.ToString()</span>

    <hr>
    @if(GameMode == GameMode.Setup){
        <Setup></Setup>
    }
    @* <h1>Your board</h1> *@
    @* <PlayerBoard GameMode=@GameMode.Setup OnAllShipsMarked=@OnAllShipsMarked /> *@
</CascadingValue>

@code {
    public GameMode GameMode;
    protected override async Task OnInitializedAsync()
    {

        // FOR TEST
        GameMode = GameMode.Setup;
        SubscribeToEvents();
        var generator = new ShipGenerator();
        var ships = generator.Generate().ToList();

        // items = ships.Select(ship => ship.Name).ToList();
    }

    public void SubscribeToEvents()
    {
        EventService.GameModeEventChanged += HandleGameModeChaged;
    }

    private void HandleGameModeChaged(object sender, GameMode gameMode) {
        GameMode = gameMode;
        StateHasChanged();
    } 

    public void Dispose()
    {
        EventService.GameModeEventChanged -= HandleGameModeChaged;
    }
}
